<!-- This file reproduces code found at: -->
<!-- https://developers.google.com/identity/sign-in/web/sign-in -->
<body>
    <a href="/profile/">Profile Page</a>

    <!-- Get the data needed to display google login button -->
    <script src="https://apis.google.com/js/platform.js?onload=renderButton" defer></script>

    <!-- Load google platform library -->
    <script src="https://apis.google.com/js/platform.js" async defer></script>

    <!-- Secret Client Key must be in SlugChat/key_file.txt -->
    <meta name="google-signin-client_id" content="{{ GOOGLE_KEY }}">

    <!-- Make sign in button -->
    <div id="my-signin2"></div>

    <div id="signout">
    <!-- Make sign out button -->
    <a href="#" onclick="signOut();">Sign out</a>
    </div>

    <div id="title">
    <b> Enrolled Courses </b>
    </div>

    <!--
        This is where the HTML from tokensignin is inserted into the 
        the page. This is filled after the user has successfully signed in.
        The HTML for this page is generated in home/ajax_class_request.html
    //-->
    <div id="classLinks">
    </div>

    <script>
    // If a user is succesfully logged in, then this function will send data
    // to the ajax view /profile/tokensignin/. That view then logs the user
    // in, and returns links to all of the classes a user is enrolled in.
    function onSuccess(googleUser) {
        var id_token = googleUser.getAuthResponse().id_token;

        // Ajax call to send google log in info. The server responds with
        // a HTML file full of links to the classes this user is enrolled in.
        // That file is generated by the /tokensignin/ view, which renders
        // the home/templates/home/ajax_class_request.html document
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if (xhr.readyState == 4 && xhr.status == 200) {
                document.getElementById("classLinks").innerHTML =
                xhr.responseText;
            }
        };
        xhr.open('POST', 'http://localhost:8000/profile/tokensignin/');
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhr.send("id_token="+id_token);
		console.log(id_token)
    }

    function onFailure(error) {
        console.log(error);
    }

    function renderButton() {
        gapi.signin2.render('my-signin2', {
                            'scope': 'profile email',
                            'longtitle': false,
                            'theme': 'dark',
                            'onsuccess': onSuccess,
                            'onfailure': onFailure
                            });
    }

    // This function calls the signout view in /userpage/views.py, which
    // removes the users 'email_address' from the request.session
    // dictionary. This function also logs people off from our website
    // via google.
    function signOut() {
        var auth2 = gapi.auth2.getAuthInstance();
        auth2.signOut().then(function () {
        window.location = "http://localhost:8000/profile/signout/"
        });
    }

    </script>
</body>
